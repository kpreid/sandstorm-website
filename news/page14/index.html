<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Sandstorm Blog</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="Sandstorm Blog">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://sandstorm.io/images/sandcat.png">
    <meta property="og:url" content="https://sandstorm.io/news/page14/">
    <meta property="og:description"
        content="Real-time collaborative web productivity suite behind the firewall.">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="alternate" type="application/rss+xml" title="Sandstorm.io Blog" href="/feed.xml">
  </head>



  <body id="blog">
    <nav>
      <a href="/">Sandstorm.io</a>
      <a href="/get">Get Sandstorm</a>
      <a href="/features">Features</a>
      <a href="/how-it-works">Technology</a>
      <a href="/news/">Blog</a>
      <a href="https://docs.sandstorm.io">Docs</a>
      <a href="https://github.com/sandstorm-io/sandstorm">Code</a>
      <a href="/community">Community</a>
      <a href="/about">About</a>
      <!-- TODO: search -->
    </nav>

    <header>
  <div class="sand">
    <h1>Sandstorm Blog</h1>
  </div>
</header>

<div class="post-list">

<div class="sidebar">
  <ul class="socialmedia">
    <li><a class="twitter" href="https://twitter.com/SandstormIO">Twitter</a>
    <li><a class="facebook" href="https://www.facebook.com/sandstorm.io" target="blank">Facebook</a>
    <li><a class="github" href="https://github.com/sandstorm-io/sandstorm" target="_blank">Github</a>
  </ul>

  <div class="more">
    <a href="/get">
      Sandstorm is a self-hostable web productivity suite.
      <span class="selfhost" href="/install">Host your own</span>
    </a>

    <h3>Recommended Posts</h3>
    <ul>
      <li><a href="/news/2014-07-21-open-source-web-apps-require-federated-hosting">Open Source Web Apps Aren't Viable; Let's Fix That</a></li>
      <li><a href="/news/2016-02-29-security-track-record">Sandstorm's security track record, and what it means for self-hosting</a></li>
      <li><a href="/news/2016-08-17-decentralization-is-about-diversity">Decentralization is about diversity</a></li>
      <li><a href="/news/2016-01-22-8-new-open-source-apps.html">8 New open source self-hostable apps</a></li>
      <li><a href="/news/2016-04-06-sandstorm-for-work">Sandstorm for Work Beta: LDAP, SAML, organization management</a></li>
      <li><a href="/news/2016-02-05-app-author-publicity-oasis">Free publicity for your indie web app, and free Oasis service for you</a></li>
      <li><a href="/news/2015-10-01-free-ssl-certificates.html">Free, automated SSL certificates for Sandstorm self-hosters</a></li>
      <li><a href="/news/2014-08-19-why-not-run-docker-apps.html">Why doesn't Sandstorm just run Docker apps?</a></li>
      <li><a href="/news/2015-05-05-delegation-is-the-cornerstone-of-civilization.html">Understand the Sandstorm sharing model</a></li>
    </ul>

    <h3>Further Reading</h3>
      <ul>
        <li><a href="/how-it-works">How Sandstorm Works</a></li>
        <li><a href="http://docs.sandstorm.io">Sandstorm Documentation</a></li>
        <li><a href="/install">How to install Sandstorm</a></li>
      </ul>
  </div>
</div>



  <nav class="pagination top">
    
      
        <a class="newer" href="/news/page13/" title="Previous Page">&laquo; Newer posts</a>
      
    

    
      <a class="older" href="/news/page15/" title="Next Page">Older posts &raquo;</a>
    
    <br clear="both">
  </nav>



<section>
  <h2><a href="/news/2015-04-13-lets-chat">Let's Chat</a></h2>
  <p class="post-details">By <a href="https://github.com/jparyani">Jason Paryani</a>
    
    - <a href="/news/2015-04-13-lets-chat">13 Apr 2015</a>
  <p><img src="/news/images/letschat.png" style="width: 100%" /></p>

<p>Last week, I packaged Let’s Chat, an open source team chat app, similar to Slack. You can try it on the Sandstorm demo <a href="https://demo.sandstorm.io/appdemo/qkgkaxfqhgsff8zgx2f4nf1a8xvmpte6wa19egmfkk06mzt7e8dh">right now</a>, or install it from the <a href="https://sandstorm.io/apps/">app list</a>.</p>

<p>As described by its developers:</p>

<blockquote>
  <p>Let’s Chat is a persistent messaging application that runs on Node.js and MongoDB. It’s designed to be easily deployable and fits well with small, intimate teams.</p>
</blockquote>

<p>A few notes on the packaging process: This package doesn’t use the normal MongoDB, but instead <a href="https://github.com/kentonv/mongo/tree/niscu">Kenton’s fork</a>. This allows the app to only use ~300KB of storage when each instance is created instead of the normal minimum of a few hundred MB for Mongo. Otherwise, the packaging process went very smoothly except for dealing with passport, a Node.js authentication library. I ended up forking <a href="https://github.com/leepowellcouk/passport-token">passport-token</a> to look at HTTP headers only (by default it will look at POST data as well, which would make it insecure inside Sandstorm). You can see the forked code <a href="https://github.com/jparyani/lets-chat/tree/sandstorm/node_modules/passport-token">here</a>, and if there’s some interest, I can work to get it published on NPM.</p>

<p>You can see the full package source <a href="https://github.com/jparyani/lets-chat">here</a>, and if you want to use <a href="https://demo.sandstorm.io/appdemo/qkgkaxfqhgsff8zgx2f4nf1a8xvmpte6wa19egmfkk06mzt7e8dh">Let’s Chat</a>, check it out on the <a href="https://sandstorm.io/apps/">app list</a>. Feel free to let me know what you think on <a href="https://groups.google.com/group/sandstorm-dev">sandstorm-dev</a>.</p>

</section>

<section>
  <h2><a href="/news/2015-04-08-osx-security-bug">Remotely send Chrome and Node.js into infinite loops via this one weird OSX kernel bug</a></h2>
  <p class="post-details">By <a href="https://github.com/kentonv">Kenton Varda</a>
    
    - <a href="/news/2015-04-08-osx-security-bug">08 Apr 2015</a>
  <p>A few months ago I discovered a security bug in the Darwin kernel used by most Apple products. The bug could allow an attacker to trivially remotely DoS a variety of network services and apps, from Node.js to Chrome. Today, <a href="https://support.apple.com/en-us/HT204659">Apple released a patch</a> (look for CVE-2015-1105), so now I can tell you about it.</p>

<p>Now, just to be clear, I’m no <a href="https://www.imperialviolet.org/">Adam Langley</a>. This bug is “just” a DoS, nothing like a Heartbleed or a Shellshock. The worst it can do is allow an attacker to cause a temporary service disruption. But I think all security bugs deserve a writeup so that we can learn from them, and Apple’s terse description of the problem doesn’t accomplish this. Also, it’s a fun story.</p>

<p>I discovered the problem while doing research on the different interfaces that various operating systems provide for doing event-driven I/O – that is, how you tell the platform: “Here are all my open connections; wake me up when one of them receives a message.” It turns out that every OS does this differently. Linux has <code>epoll</code>. BSD has <code>kqueue</code>. Windows has… well, about five different mechanisms that cover differing subsets of usecases and you can only choose one. In any case, I was trying to build an abstraction layer over these for <a href="https://capnproto.org">Cap’n Proto</a>, so I wanted to make sure I understood them all.</p>

<p>I noticed a curious thing: some man pages discussed an event called “out-of-band data” while others didn’t. “Out-of-band data” (OOB), also known as “urgent data”, is a little-used feature of TCP connections that essentially allows you to send a byte that “jumps the queue” so that the receiving app can receive it before receiving other data sent before it. You probably didn’t know about this, because basically no one uses this feature – except for Telnet, which needs a way to signal that you pressed “ctrl+C” when the destination app is not otherwise processing input.</p>

<p>With almost all event notification APIs, regular data and OOB data raise different kinds of events. For example, <code>poll()</code> (and its successor on Linux, <code>epoll</code>) has <code>POLLIN</code> for regular data and <code>POLLPRI</code> for OOB. This way, if your app does not expect to receive OOB data, it simply doesn’t ask to be notified about that type of event, and the kernel happily discards it for you (or maybe inserts it into the regular stream, which is fine).</p>

<p>Curiously, the BSD <code>kqueue</code> docs are unclear on how OOB data is handled. <a href="https://www.freebsd.org/cgi/man.cgi?query=kqueue&amp;sektion=2">FreeBSD’s <code>kqueue</code></a> makes no mention of it, and as far as I’ve been able to determine it simply doesn’t support notification of OOB events at all. <a href="http://leaf.dragonflybsd.org/cgi/web-man?command=kqueue&amp;section=2">DragonflyBSD’s <code>kqueue</code></a> defines an <code>EVFILT_EXCEPT</code> event type.</p>

<p><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man2/kqueue.2.html">Darwin’s (OSX/iOS) <code>kqueue</code></a> also doesn’t mention OOB data, but some Googling revealed an undocumented “feature”: on OOB data, Darwin will raise a regular <code>EVFILT_READ</code> event (which normally indicates that regular in-band data was received) but set the special flag <code>EV_OOBAND</code> on the event structure.</p>

<p>Of course, if you aren’t <em>expecting</em> OOB data, you’re not going to check for that flag. So when you receive <code>EVFILT_READ</code>, you’re going to believe you’ve received regular data. And you’re going to do a <code>recv()</code> call to read that data, and there isn’t going to be any. And then you’re going to say “oh well” and return to the event loop. But if you are using <code>kqueue()</code> in level-triggered mode (as most people do, because it’s easier), then the operating system is going to see that the OOB data is still there, and is going to give you <em>the exact same event again</em>.</p>

<p>So you go into an infinite loop.</p>

<p><strong>Wait, doesn’t that mean almost all event-driven OSX network apps will go into an infinite loop if they receive a single TCP packet with the urgent bit set?</strong></p>

<p>I didn’t think that could possibly be true at first, so I fired up a Mac machine to try it. Sure enough:</p>

<ul>
  <li>
    <p>When Google Chrome visited an HTTP server that sent back an OOB byte, the whole app (not just the tab, but everything) locked up and had to be force-quit. It turns out Chrome does all networking from the main process, so the per-tab process separation did not help. (<a href="https://code.google.com/p/chromium/issues/detail?id=437642">Chromium issue 437642</a> – currently still locked down as a security issue)</p>
  </li>
  <li>
    <p>When a <a href="https://nodejs.org">Node.js</a> server received an OOB byte from a client, the server would go into an infinite loop and stop handling other connections. (<a href="https://github.com/libuv/libuv/commit/e19089f7b14800d3f9bd74d9699e841e4b61a36d">fixed in this commit</a>)</p>
  </li>
</ul>

<p>On the other hand, my third test case – <a href="http://nginx.org">nginx</a> – was not affected, because it uses kqueue in edge-triggered mode, and therefore it only receives the unexpected event when new data arrives rather than any time data is available – i.e. once rather than infinity times. But two of three is a pretty worrisome hit rate, especially when these are some very big names.</p>

<p>Arguably the worst / most interesting part of this problem is that it was a problem inherent in the API. Technically it was not that the kernel was buggy, but that the interface was confusing (and underdocumented) in a way that caused the same bug to manifest in several different apps. Fixing the problem either required fixing every app (and being ever-vigilant in the future), or changing the API and <em>breaking</em> any existing app that depended on the behavior (of which there appears to be a few).</p>

<p>To Apple’s credit, they did what I think is the right thing: they changed the interface so that it no longer reports <code>EVFILT_READ</code> events on TCP OOB data. I do not quite understand their description of this problem as a “state inconsistency issue”, but my tests confirm that OOB data is now ignored.</p>

<p>The moral of the story? <strong>Confusing APIs are a security problem. If many users of your API get it wrong in a way that introduces a security bug, that’s a bug in your API, not their code.</strong></p>

</section>

<section>
  <h2><a href="/news/2015-04-06-pycon">See you at PyCon in Montreal this weekend</a></h2>
  <p class="post-details">By <a href="https://github.com/paulproteus">Asheesh Laroia</a>
    
    - <a href="/news/2015-04-06-pycon">06 Apr 2015</a>
  <p>I’m hoping to see you in Montreal at
<a href="https://us.pycon.org/2015/">PyCon 2015</a>! I’m co-speaking at a talk and
a tutorial. I’ll also be
eager to talk to people about Sandstorm and self-hosting servers.</p>

<p>Last year, I co-gave a talk about
<a href="https://www.youtube.com/watch?v=HqEJxZzbdVM">turning your computer into a server</a>
with Karen Rustad.
Here’s
what it looked like when one of my friends surprised me by changing the
data we were showing during a live demo:</p>

<p><img width="600" src="/news/images/asheesh-pycon-2014.png" /></p>

<p>That <em>Lol</em> is supposed to say <em>Django</em>. Thanks,
<a href="https://luke.wf/">Luke</a>. Check out my expression of amusement masking horror.</p>

<p>I got compromised because the Django
sample app I demo’d has a default admin account bundled with it, as part of the
demo. The good news is if you’re using Sandstorm, the platform
handles authentication &amp; authorization for apps, so this sort of thing won’t
happen to you. Plus, as you would expect, Sandstorm ships with no default
passwords.</p>

<p>This year I’m co-leading a tutorial called
<a href="https://us.pycon.org/2015/schedule/presentation/306/">Getting Comfortable With Web Security</a>
where we discuss all sorts of common security issues with web applications;
Jacky Chang and Nicole Zuckerman are my co-presenters. I’m
also sharing a stage with Philip James to answer the question,
<a href="https://us.pycon.org/2015/schedule/presentation/340/">Type python, press enter. What happens?</a></p>

<p>I hope to see you there! Doubly so if you’re interested
in a Sandstorm &amp; server self-hosting Birds of a Feather session.
Send an email to asheesh@sandstorm.io!</p>

</section>

<section>
  <h2><a href="/news/2015-03-30-rails-porting-guide">Ruby on Rails Porting Guide</a></h2>
  <p class="post-details">By <a href="https://github.com/dwrensha">David Renshaw</a>
    
    - <a href="/news/2015-03-30-rails-porting-guide">30 Mar 2015</a>
  <p>One positive side effect of my work on the
<a href="2015-01-21-gitweb-and-gitlab.html">GitLab app</a> is that we now have a
<a href="https://github.com/sandstorm-io/sandstorm/wiki/Ruby-on-Rails">porting guide</a>
tailored specifically for <a href="http://rubyonrails.org">Ruby on Rails</a>.
If you have a Rails app that you’d like to package for Sandstorm, this is
the place to start. The guide should quickly get you up and running, and it
explains how to deal with a few quirks that are particular to how Rails and
Sandstorm interact.</p>

<p>I invite you to
<a href="https://github.com/sandstorm-io/sandstorm/wiki/Ruby-on-Rails">read it</a>, to try
porting an app, and to tell me what you think! I am by no means an expert on
anything Ruby-related, so don’t hesitate to contribute corrections, either by
directly editing the wiki, by starting a discussion on the
<a href="https://groups.google.com/forum/#!forum/sandstorm-dev">sandstorm-dev</a>
mailing list, or by <a href="mailto:david@sandstorm.io">emailing me</a>.</p>

</section>

<section>
  <h2><a href="/news/2015-03-27-postcards">Postcards from Boston</a></h2>
  <p class="post-details">By <a href="https://github.com/paulproteus">Asheesh Laroia</a>
    
    - <a href="/news/2015-03-27-postcards">27 Mar 2015</a>
  <p>After visiting Boston (well, Cambridge) for
<a href="/news/2015-03-19-libreplanet.html">LibrePlanet</a>,
I met up with a few Sandstorm fans and prospsective users, and I snapped
some photos.</p>

<p>Three of us met up at
<a href="http://www.yelp.com/biz/clover-cambridge-6">Clover Kendall</a> to discuss
<a href="http://www.nightscout.info/">NightScout</a>, a free software web app for helping
people share information about their blood sugar levels with family and friends.</p>

<p><img width="600" height="400" src="/news/images/boston-nightscout.jpg" /></p>

<p>Monday evenings are the regular meeting time for
<a href="http://sipb.mit.edu">SIPB</a>, MIT’s computing club, and some of us researched if
Sandstorm could be of use to the MIT community.</p>

<p><img width="600" height="400" src="/news/images/boston-sipb.jpg" /></p>

<p>I hope to see you in my future travels!</p>

</section>


<nav class="pagination bottom">
  
    
      <a class="newer" href="/news/page13/" title="Previous Page">&laquo; Newer posts</a>
    
  

  
    <a class="older" href="/news/page15/" title="Next Page">Older posts &raquo;</a>
  
  <br clear="both">
</nav>

</div>


    <footer>
      <ul>
        <li>
          <h3><a href="/get">Get Sandstorm</a></h3>
          <ul>
            <li><a href="/get">Self-host Sandstorm</a>
            <li><a href="https://github.com/sandstorm-io/sandstorm">Source code (GitHub)</a>
            <li><a href="/go/education">For educators</a></li>
          </ul>
        </li>
        <li>
          <h3><a href="/features">Features</a></h3>
          <ul>
            <li><a href="https://apps.sandstorm.io">App Market</a></li>
            <li><a href="/features">Core features</a>
            <li><a href="/features#security">Security features</a>
            <li><a href="/business#scale-features">Scale-out</a>
            <li><a href="/business">For organizations</a>
            <li><a href="/developer">For developers</a>
          </ul>
        </li>
        <li>
          <h3><a href="https://docs.sandstorm.io">Documentation</a></h3>
          <ul>
            <li><a href="https://docs.sandstorm.io/en/latest/using/">How to use Sandstorm</a>
            <li><a href="https://docs.sandstorm.io/en/latest/developing/">Developer Hub</a>
            <li><a href="https://docs.sandstorm.io/en/latest/administering/">Administering &amp; installing</a>
            <li><a href="https://docs.sandstorm.io/en/latest/using/security-practices/">Security</a>
          </ul>
        </li>
        <li>
          <h3><a href="/how-it-works">Technology (How it Works)</a></h3>
          <ul>
            <li><a href="/how-it-works#grains">Fine-grained object containers</a>
            <li><a href="/how-it-works#capabilities">Capability-based security</a>
          </ul>
        </li>
        <li>
          <h3><a href="/community">Community</a></h3>
          <ul>
            <li><a href="/news">Sandstorm Blog</a>
            <li><a href="/community#connect-with">Connect with us</a>
            <li><a href="/community#helpothers">Help others</a>
            <li><a href="/community#helpproject">Help the project</a>
          </ul>
        </li>
        <li>
          <h3><a href="/about">About</a></h3>
          <ul>
            <li><a href="/about">Sandstorm story</a>
            <li><a href="/about#team">Team</a>
            <li><a href="/about#advisors">Advisors</a>
            <li><a href="mailto:contact@sandstorm.io">Contact</a>
          </ul>
        </li>
        <li>
          <h3>Connect</h3>
          <ul id="socialmedia-small">
						<li><a class="twitter" href="https://twitter.com/SandstormIO"></a>
						<li><a class="facebook" href="https://www.facebook.com/sandstorm.io" target="blank"></a>
						<li><a class="github" href="https://github.com/sandstorm-io/sandstorm" target="_blank"></a>
  			</ul>
        </li>
        <li>
          <ul>
            <li><a href=""></a>
          </ul>
        </li>
      </ul>
      <p>This page was hand-crafted using only the finest web technologies.
    </footer>

    <!-- livereload, for development -->
    <script type="text/javascript">
      if (document.location.hostname === "localhost") {
        document.write('<script src="http://localhost:35729/livereload.js"></scr' + 'ipt>');
      }
    </script>
  </body>
</html>
